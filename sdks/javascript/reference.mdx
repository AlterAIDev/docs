---
title: 'Reference'
description: 'Advanced configuration and API reference for Alter Connect'
---

## Session Tokens

Session tokens are temporary credentials that authorize Alter Connect without exposing your API keys.

### Token Properties

| Property | Description | Default |
|----------|-------------|---------|
| **Lifetime** | How long token is valid | 10 minutes |
| **Single use** | Can only create one connection | No |
| **IP restricted** | Locked to user's IP | Optional |
| **Provider list** | Which providers to show | All configured (if omitted) |

### Creating Secure Sessions

Always create sessions on your backend:

```javascript
// YOUR backend - never expose API keys
const response = await fetch('https://api.alter.com/oauth/connect/session', {
  method: 'POST',
  headers: {
    'x-api-key': process.env.ALTER_API_KEY,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    end_user: {
      id: user.id,
      email: user.email
    },
    attributes: {
      user_id: user.id  // Must match when retrieving tokens
    },
    allowed_providers: ['google', 'slack'],
    allowed_origin: 'https://yourapp.com'  // Optional, see below
  })
});
```

### Understanding `allowed_origin`

The `allowed_origin` parameter controls postMessage security for desktop popup flows:

| Scenario | What to Pass | Example |
|----------|-------------|---------|
| Single domain | Omit field (uses `website_url` from Developer Portal) | Configure in Portal |
| Multiple environments | Pass specific origin | `'https://staging.myapp.com'` |
| Local development | Pass localhost | `'http://localhost:3000'` |
| Server-to-server | Omit field | No validation needed |

<Warning>
**Wildcard `*` is NOT supported.** To allow any origin, omit the field or pass `null` - the system will use your `website_url` configured in the Developer Portal as a fallback.
</Warning>

**Valid origin formats:**
- ✅ `https://myapp.com`
- ✅ `http://localhost:3000`
- ⚠️ `https://myapp.com/` (trailing slash auto-removed)
- ❌ `https://myapp.com/path` (no path)
- ❌ `*` (wildcard not supported)

## Customization

Alter Connect supports basic visual customization:

```javascript
const alterConnect = AlterConnect.create({
  customization: {
    colors: {
      primary: '#6366f1',     // Button colors
      text: '#111827',        // Text color
      background: '#ffffff'   // Background color
    },
    fontFamily: '"Inter", sans-serif'
  },
  debug: true  // Enable console logging
});
```

### Available Options

| Option | Type | Description |
|--------|------|-------------|
| `colors.primary` | string | Primary button color |
| `colors.text` | string | Text color |
| `colors.background` | string | Background color |
| `fontFamily` | string | Font family |
| `debug` | boolean | Enable console logs |
| `locale` | string | Language (en, es, fr, de) |

## Open Options

Configure the widget when opening:

```javascript
await alterConnect.open({
  // Required
  token: sessionToken,           // From your backend
  onSuccess: (connection) => {}, // Success callback

  // Optional
  onError: (error) => {},        // Error callback
  onExit: () => {},              // Called when user closes without connecting
  onEvent: (name, meta) => {},   // Analytics events
  baseURL: 'https://...'        // Override API URL (testing)
});
```

## Connection Object

After successful connection:

```typescript
interface Connection {
  connection_id: string;      // Unique ID for this connection
  provider: string;            // Provider ID (e.g., 'google')
  provider_name: string;       // Display name (e.g., 'Google')
  account_identifier: string;  // User's email/username
  timestamp: string;           // ISO 8601 timestamp
  operation: 'creation' | 'reauth';  // New connection or re-authorization
  scopes: string[];           // OAuth scopes granted
  status: 'active' | 'pending' | 'error';
  metadata?: {                // Optional provider-specific data
    account_display_name?: string;
    account_email?: string;
  };
}
```

## Error Handling

Handle errors gracefully:

```javascript
await alterConnect.open({
  token: sessionToken,
  onSuccess: (connection) => {
    // Save connection_id to your database
    saveConnection(connection.connection_id);
  },
  onError: (error) => {
    console.error('Connection failed:', error);

    switch(error.code) {
      case 'popup_blocked':
        // Browser blocked the popup
        alert('Please allow popups for this site');
        break;
      case 'oauth_error':
        // OAuth provider issue
        alert('Provider error. Please try again.');
        break;
      case 'network_error':
        // Could not reach Alter API
        alert('Network error. Please check your connection.');
        break;
      case 'timeout':
        // Request timed out
        alert('Request timed out. Please try again.');
        break;
      default:
        alert('Connection failed. Please try again.');
    }
  }
});
```

## Browser Support

| Browser | Minimum Version |
|---------|----------------|
| Chrome/Edge | 90+ |
| Firefox | 88+ |
| Safari | 14+ |
| iOS Safari | 14+ |
| Chrome Mobile | Latest |

## Content Security Policy

If using CSP, add these directives:

```html
<meta http-equiv="Content-Security-Policy"
      content="frame-src https://api.alter.com;
               connect-src https://api.alter.com;
               script-src 'self' https://cdn.jsdelivr.net;">
```

## TypeScript

Full TypeScript support included:

```typescript
import AlterConnect, {
  AlterConnectConfig,
  OpenOptions,
  Connection,
  AlterError
} from '@alter-ai/connect';

const config: AlterConnectConfig = {
  customization: {
    colors: { primary: '#6366f1' }
  }
};

const alterConnect = AlterConnect.create(config);
```

## Methods

### `AlterConnect.create(config?)`

Create an instance with optional configuration.

### `alterConnect.open(options)`

Open the OAuth connection flow. Returns a Promise.

### `alterConnect.close()`

Programmatically close the widget.

### `alterConnect.destroy()`

Clean up and remove event listeners.

## Events

Listen to widget events:

```javascript
alterConnect.on('provider_selected', (provider) => {
  console.log('User selected:', provider);
});

alterConnect.on('connection_started', () => {
  console.log('OAuth flow started');
});

alterConnect.on('connection_complete', (connection) => {
  console.log('Connection successful:', connection);
});
```

## Troubleshooting

### Widget Not Opening

- Verify session token is valid (not expired)
- Check browser console for errors
- Ensure popup blockers are disabled

### Connection Fails

- Verify OAuth app credentials in Developer Portal
- Check redirect URI matches exactly
- Ensure scopes are configured correctly

### Tokens Not Working

- Confirm attribution matches between session and token request
- Verify connection was completed successfully
- Check token hasn't expired (auto-refresh should handle this)

## Security Best Practices

1. **Never expose API keys** - Always create sessions server-side
2. **Use short-lived tokens** - 10 minutes or less
3. **Implement IP restrictions** - Lock sessions to user's IP
4. **Validate on backend** - Always verify connection on your server
5. **Use HTTPS** - Never use in production without HTTPS
